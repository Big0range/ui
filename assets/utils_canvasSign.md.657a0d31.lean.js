var y=Object.defineProperty;var h=(c,n,s)=>n in c?y(c,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):c[n]=s;var p=(c,n,s)=>(h(c,typeof n!="symbol"?n+"":n,s),s);import"./chunks/dayjs.min.ea7bbe63.js";import{e as C,i as A,o as u,c as d,z as o,a as g,O as b}from"./chunks/framework.54e68f16.js";let m={},v=m.hasOwnProperty,E=v.toString;E.call(Object);const f={width:300,height:150,lineWidth:2,lineColor:"#fff",bgColor:"#000",bgImage:""};class q{constructor(n,s){p(this,"canvas");p(this,"options",{...f});p(this,"ctx");p(this,"stop",!0);p(this,"X",0);p(this,"Y",0);p(this,"points",[]);p(this,"currentPoints",[]);p(this,"currentPoint",{data:[],lineWidth:this.options.lineWidth,lineColor:this.options.lineColor});p(this,"callbacks",[]);this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.options={...this.options,...s},this.canvas.width=this.options.width,this.canvas.height=this.options.height,this.ctx.lineCap="round",n.appendChild(this.canvas),this.init()}getThis(){return this}prev(){this.points.length>0&&this.currentPoints.length!==0&&(this.currentPoints=this.points.slice(0,this.currentPoints.length-1),this.draw())}next(){this.points.length>0&&this.currentPoints.length!==this.points.length&&(this.currentPoints=this.points.slice(0,this.currentPoints.length+1),this.draw())}async draw(){console.log("重绘"),this.ctx.clearRect(0,0,this.options.width,this.options.height),await this.init(!0),this.currentPoints.forEach(n=>{this.ctx.lineWidth=n.lineWidth,this.ctx.strokeStyle=n.lineColor,this.ctx.beginPath();for(let s=0;s<n.data.length;s++){const a=n.data[s],t=n.data[s-1];s!==0&&(this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(a.x,a.y))}this.ctx.stroke()})}async init(n){if(this.ctx.fillStyle=this.options.bgColor,this.ctx.fillRect(0,0,this.options.width,this.options.height),this.options.bgImage){let s;typeof this.options.bgImage=="string"?s=await new Promise((r,l)=>{const e=new Image;e.setAttribute("crossOrigin","anonymous"),e.src=this.options.bgImage,e.onload=()=>{console.log(e.width,e.height),r(e)},e.onerror=F=>{l(F)}}):(s=this.options.bgImage,s.setAttribute("crossOrigin","anonymous"),s.complete||(console.log("https://big0range.github.io/ui/logo.png"),await new Promise((r,l)=>{s.onload=()=>{r()},s.onerror=l})));const a=this.options.width/s.width,t=this.options.height/s.height;a>t?(s.width=s.width*a,s.height=s.height*a):(s.width=s.width*t,s.height=s.height*t);const i=s.height-this.options.height,D=s.width-this.options.width;console.log(s.width,s.height),this.ctx.drawImage(s,-D/2,-i/2,s.width,s.height)}n||this.bindEvent()}bindEvent(){console.log("bindEvent"),this.canvas.addEventListener("touchstart",this.handleMouseDown.bind(this)),this.canvas.addEventListener("touchmove",this.handleMouseMove.bind(this)),this.canvas.addEventListener("touchend",this.handleMouseUp.bind(this)),this.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.handleMouseUp.bind(this))}getXY(n){let s,a;return n instanceof TouchEvent?(s=n.touches[0].clientX-this.canvas.offsetLeft,a=n.touches[0].clientY-this.canvas.offsetTop):(s=n.offsetX,a=n.offsetY),{x:s,y:a}}handleMouseDown(n){const{x:s,y:a}=this.getXY(n);this.stop=!1,this.ctx.lineWidth=this.options.lineWidth,this.ctx.strokeStyle=this.options.lineColor,this.X=s,this.Y=a,this.currentPoint={data:[{x:s,y:a}],lineWidth:this.options.lineWidth,lineColor:this.options.lineColor}}handleMouseMove(n){if(this.stop)return;const{x:s,y:a}=this.getXY(n);this.ctx.beginPath(),this.ctx.moveTo(this.X,this.Y),this.X=s,this.Y=a,this.ctx.lineTo(s,a),this.ctx.stroke(),this.currentPoint.data.push({x:s,y:a})}handleMouseUp(n){console.log("handleMouseUp"),this.stop=!0,this.currentPoints.push(this.currentPoint),this.points=[...this.currentPoints]}setLineColor(n){this.options.lineColor=n}setLineWidth(n){this.options.lineWidth=n}change(n){const s={totalStep:this.points.length,totalPoints:this.points,currentStep:this.currentPoints.length,currentPoints:this.currentPoints[-1]};n(s)}on(n,s){}download(n,s="image/png"){const a=document.createElement("a");a.download=n,a.href=this.canvas.toDataURL(s),a.click(),a.remove()}}const w=o("h1",{id:"canvassign-手绘签名",tabindex:"-1"},[g("canvasSign 手绘签名 "),o("a",{class:"header-anchor",href:"#canvassign-手绘签名","aria-label":'Permalink to "canvasSign 手绘签名"'},"​")],-1),x=o("div",{class:"canvas-sign"},null,-1),S=b("",2),W=JSON.parse('{"title":"canvasSign 手绘签名","description":"","frontmatter":{},"headers":[],"relativePath":"utils/canvasSign.md","lastUpdated":1693194878000}'),_={name:"utils/canvasSign.md"},L=Object.assign(_,{setup(c){C(0);let n;const s=()=>{n.download("test.png","image/jpeg")};A(()=>{try{n=new q(document.querySelector(".canvas-sign"),{width:500,height:500,bgColor:"#000",lineWidth:5})}catch(l){console.log(l)}});const a=l=>{console.log(l.target.value),n.setLineWidth(l.target.value)},t=l=>{console.log(l.target.value),n.setLineColor(l.target.value)},i=()=>{console.log(n.getThis())},D=()=>{n.prev()},r=()=>{n.next()};return(l,e)=>(u(),d("div",null,[w,o("div",null,[o("div",{onClick:i},"getThis"),o("div",{onClick:D},"上一步"),o("div",{onClick:r},"下一步"),o("div",null,[o("input",{onChange:t,value:"#ffffff",type:"color"},null,32)]),o("div",null,[o("input",{type:"range",value:"2",onChange:a},null,32)]),o("div",{onClick:s},"导出"),x]),S]))}});export{W as __pageData,L as default};
